<!DOCTYPE html>
<html lang='en'>

<head>
    <meta charset='utf-8' />
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.0.3/index.global.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.js"
        integrity="sha512-wUa0ktp10dgVVhWdRVfcUO4vHS0ryT42WOEcXjVVF2+2rcYBKTY7Yx7JCEzjWgPV+rj2EDUr8TwsoWF6IoIOPg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.3/moment.min.js"></script>
    <link rel="stylesheet" href="static/schedule-maker.css">
    <script>

        var selectStart = '';
        var selectEnd = '';
        var eventName = '';
        var eventColor = '';
        var calendar;

        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.querySelector('.calendar');
            calendar = new FullCalendar.Calendar(calendarEl, {
                timeZone: 'EST',
                headerToolbar: {
                    left: '',
                    center: 'addEventButton',
                    right: 'timeGridWeek'
                },
                slotLabelInterval: {
                    hours: 0.5
                },
                firstDay: 1,
                hiddenDays: [0, 6],
                dayHeaderFormat: {
                    weekday: 'long'
                },
                slotLabelFormat: {
                    hour: 'numeric',
                    minute: '2-digit',
                    omitZeroMinute: false,
                    hour12: false
                },
                eventTimeFormat: {
                    hour: '2-digit',
                    minute: '2-digit',
                    meridiem: false,
                    hour12: false,
                },
                initialView: 'timeGridWeek',
                slotDuration: '00:30:00',
                slotMinTime: '08:00:00',
                slotMaxTime: '18:00:00',
                expandRows: true,
                displayEventEnd: true,
                allDaySlot: false,
                editable: true,
                dayMaxEvents: true,
                contentHeight: 'auto',
                customButtons: {
                    addEventButton: {
                        text: 'Add event',
                        click: function () {
                            calendar.addEvent({
                                title: eventName,
                                start: selectStart,
                                end: selectEnd,
                                backgroundColor: eventColor
                            });
                        }
                    }
                },
                selectable: true,
                select: (info) => {
                    selectStart = info.start
                    selectEnd = info.end
                },
                longPressDelay: 150
            });
            calendar.setOption('slotLabelFormat', function (data) {
                return moment(data.date).format("HH:mm") + " - " + moment(data.date).add(30, 'minutes').format("HH:mm");
            });

            calendar.render();
        });

    </script>
</head>

<body>
    <main>
        <div class='calendar'>
            <input class="event-name-input" type="text" placeholder="Event Name">
            <input class="event-color-input" type="color" value="#3788d8">
            <button class="save-btn">Save</button>
        </div>
    </main>
</body>

<script>
    eventNameInput = document.querySelector('.event-name-input')
    eventNameInput.onblur = () => {
        eventName = eventNameInput.value
    }
    eventName = eventNameInput.value

    eventColorInput = document.querySelector('.event-color-input')
    eventColorInput.onblur = () => {
        eventColor = eventColorInput.value
    }
    eventColor = eventColorInput.value

    saveBtn = document.querySelector('.save-btn')
    saveBtn.onclick = () => {
        console.log(calendar.getEvents())
        domtoimage.toJpeg(document.querySelector('.fc-view-harness'), { quality: 0.95 }).then((dataUrl) => {
            var link = document.createElement('a');
            link.download = 'schedule.png';
            link.href = dataUrl;
            link.click();
        })
    }

    eventColorInput.onchange = () => {
        document.documentElement.style.setProperty('--highlight-colour', eventColorInput.value);
    }
    document.documentElement.style.setProperty('--highlight-colour', eventColorInput.value);
</script>

</html>
