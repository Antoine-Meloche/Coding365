<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Schedules Website</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <ul>
    </ul>
  </body>
  <style>
    body{
      font-family: Arial, Helvetica, 'sans-serif';
      background-color: #242424;
      margin: none;
      padding: none;
    }

    li {
      font-size: 5vw;
      color: white
    }

    ul {
      list-style: none
    }

    a {
      color: white
    }
  </style>
  <script>
    const queryString = window.location.search;
    const parameters = new URLSearchParams(queryString);
    const id = parameters.get('id');
    var schedules;
    fetch(`schedules?id=${id}`).then((response) => response.json()).then((data) => {
      schedules = data;
      updateTime();
    });

    const ul = document.querySelector('ul');

    var currentTime;

    function updateTime() {
      currentTime = new Date()

      updateUI()
    }
    setInterval(updateTime, 60000);

    function updateUI() {
      ul.innerHTML = "";
      for (var name of Object.keys(schedules)) {
        var day = currentTime.getDay();

        var person_li = document.createElement('li');

        for (var event of Object.keys(schedules[name][day])) {
          startTimeMinutes = parseInt(schedules[name][day][event]['start'].split('h')[1]);
          startTimeHours = parseInt(schedules[name][day][event]['start'].split('h')[0]);

          endTimeInt = parseInt(schedules[name][day][event]['start'].split('h')[1]) + parseInt(schedules[name][day][event]['start'].split('h')[0])*60 + schedules[name][day][event]['duration'];
          endTimeHours = Math.floor(endTimeInt / 60);
          endTimeMinutes = endTimeInt - endTimeHours*60;
          endTimeStr = `${endTimeHours}h${endTimeMinutes < 10 ? '0' : ''}${endTimeMinutes}`;
          if ((endTimeHours > currentTime.getHours() | (endTimeHours == currentTime.getHours() & endTimeMinutes > currentTime.getMinutes())) & (startTimeHours <= currentTime.getHours() | (startTimeHours==currentTime.getHours() & startTimeMinutes <= currentTime.getMinutes()))) {
            person_li.innerHTML += `<a href="${name}.png?id=${id}">${name}</a> ðŸ”´: ${event} - ${schedules[name][day][event]['room']} until ${endTimeStr}<br>`;
          }
        }

        if (person_li.innerHTML == "") {
          person_li.innerHTML = `<a href="${name}.png?id=${id}">${name}</a> ðŸŸ¢: Not now`;
        }

        ul.appendChild(person_li);
      }
    }
  </script>
</html>
